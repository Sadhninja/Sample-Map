<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 50px;
            }

            #login {
                display: none;
                margin: auto;
                width: 300px;
                padding: 20px;
                border: 1px solid #ccc;
                box-shadow: 0px 0px 10px 0px #000;
            }

            #login input[type="text"], #login input[type="password"] {
                width: 100%;
                padding: 10px;
                margin: 5px 0 20px 0;
                border: 1px solid #ccc;
            }

            #login button {
                width: 100%;
                padding: 10px;
                background-color: #5cb85c;
                color: white;
                border: none;
                cursor: pointer;
            }

            #login button:hover {
                background-color: #4cae4c;
            }

            #map {
                width: 1606px;
                height: 805px;
                display: none;
            }

            .legend {
                padding: 6px 8px;
                font: 14px Arial, Helvetica, sans-serif;
                background: white;
                background: rgba(255, 255, 255, 0.8);
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                line-height: 24px;
                color: #555;
            }

            .legend i {
                width: 24px;
                height: 24px;
                float: left;
                margin-right: 8px;
                opacity: 0.7;
            }
        </style>
        <title>Sample Map</title>
    </head>
    <body>
        <div id="login">
            <h2>Login</h2>
            <input type="text" id="username" placeholder="Username" />
            <input type="password" id="password" placeholder="Password" />
            <button onclick="login()">Login</button>
        </div>
        <div id="map"></div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script>
            const validUsername = 'user';
            const validPassword = 'password';

            function login() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username === validUsername && password === validPassword) {
                    document.getElementById('login').style.display = 'none';
                    document.getElementById('map').style.display = 'block';
                    initMap();
                } else {
                    alert('Invalid username or password');
                }
            }

            function initMap() {
                var map = L.map('map', {
                    zoomControl: true, maxZoom: 28, minZoom: 1
                });
                var hash = new L.Hash(map);
                //map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
                var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});

                function removeEmptyRowsFromPopupContent(content, feature) {
                    var tempDiv = document.createElement('div');
                    tempDiv.innerHTML = content;
                    var rows = tempDiv.querySelectorAll('tr');
                    for (var i = 0; i < rows.length; i++) {
                        var td = rows[i].querySelector('td.visible-with-data');
                        var key = td ? td.id : '';
                        if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                            rows[i].parentNode.removeChild(rows[i]);
                        }
                    }
                    return tempDiv.innerHTML;
                }

                document.querySelector(".leaflet-popup-pane").addEventListener("load", function(event) {
                    var tagName = event.target.tagName,
                        popup = map._popup;
                    // Also check if flag is already set.
                    if (tagName === "IMG" && popup && !popup._updated) {
                        popup._updated = true; // Set flag to prevent looping.
                        popup.update();
                    }
                }, true);

                L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);
                var bounds_group = new L.featureGroup([]);

                function setBounds() {
                    if (bounds_group.getLayers().length) {
                        map.fitBounds(bounds_group.getBounds());
                    }
                }

                map.createPane('pane_mmr_pd_2020_1km_0');
                map.getPane('pane_mmr_pd_2020_1km_0').style.zIndex = 400;
                var img_mmr_pd_2020_1km_0 = 'data/mmr_pd_2020_1km_0.png';
                var img_bounds_mmr_pd_2020_1km_0 = [[8.816250161118141, 92.19041630814351], [28.549583415518143, 101.17374960554352]];
                var layer_mmr_pd_2020_1km_0 = new L.imageOverlay(img_mmr_pd_2020_1km_0,
                    img_bounds_mmr_pd_2020_1km_0,
                    { pane: 'pane_mmr_pd_2020_1km_0' });
                bounds_group.addLayer(layer_mmr_pd_2020_1km_0);
                map.addLayer(layer_mmr_pd_2020_1km_0);
                var baseMaps = {};
                var overlaysTree = [
                    { label: "mmr_pd_2020_1km", layer: layer_mmr_pd_2020_1km_0 },
                ]
                var lay = L.control.layers.tree(null, overlaysTree, {
                    //namedToggle: true,
                    //selectorBack: false,
                    //closedSymbol: '&#8862; &#x1f5c0;',
                    //openedSymbol: '&#8863; &#x1f5c1;',
                    //collapseAll: 'Collapse all',
                    //expandAll: 'Expand all',
                    collapsed: false,
                });
                lay.addTo(map);
                setBounds();
                L.ImageOverlay.include({
                    getBounds: function () {
                        return this._bounds;
                    }
                });

                // Create a legend
                var legend = L.control({position: 'bottomright'});

                legend.onAdd = function (map) {
                    var div = L.DomUtil.create('div', 'legend'),
                        grades = ['< 20', '20-40', '40-60', '60-80', '80-100', '100-120', '120-140', '140-160', '160-180', '> 180'],
                        colors = ['#2b83ba', '#64abb0', '#9dd3a6', '#c7e8ad', '#ecf7b9', '#ffedaa', '#fec980', '#f99d59', '#e85b3b', '#d7191c'];

                    for (var i = 0; i < grades.length; i++) {
                        div.innerHTML +=
                            '<i style="background:' + colors[i] + '"></i> ' +
                            grades[i] + (grades[i + 1] ? '<br>' : '');
                    }

                    return div;
                };

                legend.addTo(map);
            }

            document.getElementById('login').style.display = 'block';
        </script>
    </body>
</html>
